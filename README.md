# 蛋白质溶解度预测模型复现

该项目旨在复现论文"Predicting the effects of mutations on protein solubility using graph convolution network and protein language model representation"中的关键组件。

## 待实现的三个关键任务

1. **蛋白质三维结构的 gcn 邻接矩阵表示**：使用预测的蛋白质三维结构，通过二维距离图来表示 gcn 邻接矩阵
2. **使用 prottrans 进行序列特征提取**：通过 prottrans 模型对蛋白质序列进行特征提取
3. **LSTM 溶解度预测模型**：训练一个蛋白质溶解度预测模型 LSTM 来提取溶解度相关特征

### 关于第一个复现任务 - 构建邻接矩阵

根据论文 2.2.3 节 "Adjacency matrix" 和 2.2.4 节 "Node selection"，以及图1的整体流程，论文的完整步骤是：

1. 首先使用 AlphaFold 预测蛋白质的三维结构
2. 从预测的三维结构中提取 Cα 原子坐标
3. 计算所有 Cα 原子之间的距离，生成完整的距离图
4. **然后**根据公式 (1) 将距离转换为邻接矩阵:
   ```
   sij = 2/(1 + max(d0,dij)/d0)
   ```
   其中 d0 设为 4.0 Å

5. **之后**使用 ProtTrans 提取野生型和突变型序列的特征
6. 计算两者特征的差异，选择差异最大的 30 个残基作为节点
7. 只保留这 30 个残基构成的子邻接矩阵，作为 GCN 的输入

所以，答案是：**先构建完整的邻接矩阵，然后再使用 ProtTrans 选择 30 个残基**。

### 论文研究的完整步骤

1. **数据准备**：
   - 使用来自 Pon-Sol2 研究的数据集
   - 包含 6328 个突变，分为溶解度降低、不变和增加三类
   - 训练集 5666 个突变，测试集 662 个突变

2. **特征提取**：
   - 使用 AlphaFold 预测蛋白质三维结构
   - 使用 ProtTrans 提取蛋白质序列特征
   - 预训练蛋白质溶解度预测模型，提取注意力池化特征

3. **距离图和邻接矩阵构建**：
   - 从三维结构中提取 Cα 原子坐标
   - 计算所有残基之间的距离图
   - 使用公式 sij = 2/(1 + max(d0,dij)/d0) 将距离转换为邻接矩阵

4. **节点选择**：
   - 计算野生型和突变型序列的 ProtTrans 特征差异
   - 选择差异最大的 30 个残基作为 GCN 的节点
   - 这些残基平均与突变位点的距离更近 (13.87 Å vs 27.79 Å)

5. **图卷积网络**：
   - 以 30 个选中的残基作为节点
   - 以节点间的邻接关系作为边
   - 采用 2 层 GCN，中间层 64 维，最后层 16 维

6. **特征融合**：
   - GCN 输出的特征与预训练的注意力池化特征拼接
   - 通过自注意力池化获取全局嵌入
   - 通过全连接层进行最终预测

7. **训练策略**：
   - 10 折交叉验证
   - 使用 Adam 优化器和均方误差损失函数
   - 采用数据增强策略（反向突变）

8. **临床应用验证**：
   - 在 ClinVar 数据库的临床相关基因上应用该方法
   - 预测的溶解度变化能够区分致病性突变

因此，第一个复现任务（构建邻接矩阵）应该是：使用 AlphaFold 预测的蛋白质结构，提取所有 Cα 原子坐标，计算距离图，然后转换为邻接矩阵。选择 30 个敏感残基是后续步骤，不是第一个任务的一部分。

### 1. 计算野生型和突变型序列的特征差异是为了什么？

计算野生型和突变型序列的特征差异是为了**识别对突变最敏感的残基**。这样做的目的有：

- **减少计算复杂度**：从全部残基（可能有几百个）减少到只有30个，大大降低了GCN的计算量
- **提高信息效率**：只关注那些对突变响应最大的残基，减少冗余信息
- **增强模型性能**：特征差异大的残基通常是对蛋白质功能和结构影响最大的残基
- **改善生物学意义**：这些敏感残基往往与突变位点在空间上更接近，与突变的物理影响更相关

论文通过计算发现，选出的30个残基与突变位点的平均距离（13.87 Å）比其他残基（27.79 Å）显著小，证明了这种选择策略的合理性。

### 2. 从三维结构中提取 Cα 原子坐标，是对一个蛋白质的所有残基提取吗？

是的，**首先对蛋白质的所有残基提取Cα原子坐标**。步骤如下：

- 使用AlphaFold预测整个蛋白质的三维结构
- 从这个完整结构中提取所有氨基酸残基的Cα原子坐标
- 基于这些完整坐标计算距离图和邻接矩阵
- 在得到完整的距离图和邻接矩阵后，才进行30个敏感残基的选择

```
### 3. 选择差异最大的 30 个残基作为 GCN 的节点，意思是每一个GCN都只处理一个蛋白质结构吗？

是的，**每次GCN处理一个突变对（野生型-突变型）**，步骤是：

- 对于每一个突变预测，模型会：
  - 处理一个野生型蛋白质结构
  - 对应一个特定的突变（如A23G，第23位氨基酸从A变为G）
  - 计算这个特定突变前后的序列特征差异
  - 为这个特定突变选择30个最敏感的残基
  - 构建这30个残基之间的图结构
  - 使用GCN处理这个图结构，预测这个特定突变对溶解度的影响

- 对于另一个突变预测，可能会选择不同的30个残基作为节点

每个突变预测任务都是独立的，使用相同的GCN模型架构，但处理的节点（敏感残基）可能不同。模型不是一次性处理所有可能的突变，而是每次处理一个特定的突变对溶解度的影响。

所以，简单说：
- 每次GCN处理一个蛋白质的一个特定突变
- 选择的30个敏感残基是针对这个特定突变的
- 不同的突变可能会选择不同的30个敏感残基
